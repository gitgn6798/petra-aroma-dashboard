<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Petra Aroma Ad Spend Dashboard Insights</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f8f9fa;
    }
    h1 {
      text-align: center;
    }
    .controls, .kpis, .chart-section, .ranking-table, .audience-section {
      margin-bottom: 40px;
    }
    .kpis {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .kpi-box {
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      width: 200px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .kpi-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #f1f1f1;
    }
    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      align-items: center;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .audience-section {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .audience-chart {
      flex: 1 1 300px;
      min-width: 300px;
    }
    .placeholder {
      text-align: center;
      margin-top: 40px;
      font-size: 1rem;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Petra Aroma Ad Spend Dashboard Insights</h1>

  <div class="controls">
    <div class="filter-row">
      <label for="fileInput"><strong>Upload JSON File:</strong></label>
      <input type="file" id="fileInput" accept="application/json" />
      <label for="adNameSelect">Ad Name:</label>
      <select id="adNameSelect"><option value="All">All</option></select>
      <label for="deliverySelect">Delivery:</label>
      <select id="deliverySelect"><option value="All">All</option></select>
      <label for="ctrTierSelect">CTR Tier:</label>
      <select id="ctrTierSelect">
        <option value="All">All</option>
        <option value="Low">Low (&lt;1%)</option>
        <option value="Medium">Medium (1-2%)</option>
        <option value="High">High (&gt;2%)</option>
      </select>
    </div>
    <div class="placeholder" id="placeholderMessage">
      Please upload a JSON file to begin.
    </div>
  </div>

  <div class="kpis">
    <div class="kpi-box"><div class="kpi-title">Total Spend (USD)</div><div id="totalSpend">-</div></div>
    <div class="kpi-box"><div class="kpi-title">Total Impressions</div><div id="totalImpressions">-</div></div>
    <div class="kpi-box"><div class="kpi-title">Total Reach</div><div id="totalReach">-</div></div>
    <div class="kpi-box"><div class="kpi-title">Avg. Frequency</div><div id="avgFrequency">-</div></div>
    <div class="kpi-box"><div class="kpi-title">Avg. CTR (All)</div><div id="avgCTR">-</div></div>
    <div class="kpi-box"><div class="kpi-title">Avg. CPC (Link)</div><div id="avgCPC">-</div></div>
  </div>

  <div class="chart-section">
    <div id="spendChart" class="chart"></div>
    <div id="ctrChart" class="chart"></div>
    <div id="cpcChart" class="chart"></div>
  </div>

  <div class="audience-section">
    <div class="audience-chart" id="genderChart"></div>
    <div class="audience-chart" id="ageChart"></div>
    <div class="audience-chart" id="locationChart"></div>
  </div>

  <div class="ranking-table">
    <h2>Ad Ranking Overview</h2>
    <table>
      <thead>
        <tr><th>Ad Name</th><th>Quality</th><th>Engagement</th><th>Conversion</th></tr>
      </thead>
      <tbody id="rankingBody"></tbody>
    </table>
  </div>
<script>
  let rawData = [];

  const fileInput = document.getElementById('fileInput');
  const adNameSelect = document.getElementById('adNameSelect');
  const deliverySelect = document.getElementById('deliverySelect');
  const ctrTierSelect = document.getElementById('ctrTierSelect');
  const placeholderMessage = document.getElementById('placeholderMessage');

  fileInput.addEventListener('change', event => {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      try {
        rawData = JSON.parse(e.target.result);
        populateFilters();
        updateDashboard();
        placeholderMessage.style.display = 'none';
      } catch (err) {
        alert('Error parsing JSON file. Please ensure it is a valid JSON format.');
      }
    };
    reader.readAsText(file);
  });

  [adNameSelect, deliverySelect, ctrTierSelect].forEach(el => el.addEventListener('change', updateDashboard));

  function populateFilters() {
    const adNames = [...new Set(rawData.map(r => r["Ad name"]))];
    const deliveries = [...new Set(rawData.map(r => r["Ad delivery"]))];
    adNameSelect.innerHTML = '<option value="All">All</option>' + adNames.map(a => `<option>${a}</option>`).join('');
    deliverySelect.innerHTML = '<option value="All">All</option>' + deliveries.map(d => `<option>${d}</option>`).join('');
  }

  function updateDashboard() {
    let data = [...rawData];
    const ad = adNameSelect.value;
    const delivery = deliverySelect.value;
    const ctrTier = ctrTierSelect.value;

    if (ad !== 'All') data = data.filter(r => r["Ad name"] === ad);
    if (delivery !== 'All') data = data.filter(r => r["Ad delivery"] === delivery);
    if (ctrTier !== 'All') {
      data = data.filter(r => {
        const ctr = r["CTR (link click-through rate)"] || 0;
        return ctrTier === 'Low' ? ctr < 1 : ctrTier === 'Medium' ? ctr >= 1 && ctr <= 2 : ctr > 2;
      });
    }

    const totalSpend = data.reduce((sum, r) => sum + (r["Amount spent (USD)"] || 0), 0);
    const totalImpressions = data.reduce((sum, r) => sum + (r["Impressions"] || 0), 0);
    const totalReach = data.reduce((sum, r) => sum + (r["Reach"] || 0), 0);
    const avgFrequency = (data.reduce((sum, r) => sum + (r["Frequency"] || 0), 0) / data.length).toFixed(2);
    const avgCTR = (data.reduce((sum, r) => sum + (r["CTR (all)"] || 0), 0) / data.length).toFixed(2);
    const avgCPC = (data.reduce((sum, r) => sum + (r["CPC (cost per link click) (USD)"] || 0), 0) / data.length).toFixed(2);

    document.getElementById('totalSpend').textContent = `$${totalSpend.toFixed(2)}`;
    document.getElementById('totalImpressions').textContent = totalImpressions.toLocaleString();
    document.getElementById('totalReach').textContent = totalReach.toLocaleString();
    document.getElementById('avgFrequency').textContent = avgFrequency;
    document.getElementById('avgCTR').textContent = `${avgCTR}%`;
    document.getElementById('avgCPC').textContent = `$${avgCPC}`;

    const adNames = data.map(r => r["Ad name"]);
    const spends = data.map(r => r["Amount spent (USD)"]);
    const ctrs = data.map(r => r["CTR (link click-through rate)"]);
    const cpcs = data.map(r => r["CPC (cost per link click) (USD)"]);

    Plotly.newPlot('spendChart', [{ x: adNames, y: spends, type: 'bar', name: 'Spend' }], { title: 'Ad Spend by Ad Name' });
    Plotly.newPlot('ctrChart', [{ x: adNames, y: ctrs, type: 'bar', name: 'CTR' }], { title: 'CTR (Link) by Ad Name' });
    Plotly.newPlot('cpcChart', [{ x: adNames, y: cpcs, type: 'bar', name: 'CPC' }], { title: 'CPC (Link) by Ad Name' });

    const rankBody = document.getElementById('rankingBody');
    rankBody.innerHTML = data.map(r => {
      return `<tr><td>${r["Ad name"]}</td><td>${r["Quality ranking"] || '-'}</td><td>${r["Engagement rate ranking"] || '-'}</td><td>${r["Conversion rate ranking"] || '-'}</td></tr>`;
    }).join('');

    Plotly.newPlot('genderChart', [{ labels: ['Female', 'Male', 'Other'], values: [0, 0, 0], type: 'pie' }], { title: 'Gender Breakdown (Placeholder)' });
    Plotly.newPlot('ageChart', [{ x: ['18-24', '25-34', '35-44', '45+'], y: [0, 0, 0, 0], type: 'bar' }], { title: 'Age Distribution (Placeholder)' });
    Plotly.newPlot('locationChart', [{ x: ['US', 'UK', 'Canada'], y: [0, 0, 0], type: 'bar' }], { title: 'Top Locations (Placeholder)' });
  }
</script>
</body>
</html>
